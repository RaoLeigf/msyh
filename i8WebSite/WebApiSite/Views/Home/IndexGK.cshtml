@{
    ViewBag.Title = "";
    Layout = null;
}

<link rel="stylesheet" href="~/Content/bootstrap.css" />

<style>
    textarea {
        width: 98%;
        height: 74%;
    }
</style>

<div class="jumbotron">
    <h1>支付测试页面</h1>
    <!--<p><a href="file:///G:\LiMing\14——资金拨付\0521\index.html" class="btn btn-primary btn-lg">查看原型 &raquo;</a></p>-->
</div>

<div class="row" style="left:45px!important;right:45px!important;">

    <button id="searchUSB">UsbKey测试</button>
    <button id="getPayUsbKeyState">UsbKey是否启用</button>



    <table id="Table5" style="z-index: 101; left: 8px; width: 100%; position: absolute;top: 610px" cellspacing="1" cellpadding="1" border="0">
            <tr>
                <td align="center" style="height: 22px">
                    <object name="AF" width="100%" height="25" classid="clsid:B371A9E1-158C-4318-B6F7-8D0BB9AE041E" codebase="http://127.0.0.1:8088/custom2/Resource/Newgrand.cab#Version=6,8,0,3">
                        <PARAM NAME="_Version" VALUE="65536">
                        <PARAM NAME="_ExtentX" VALUE="32147">
                        <PARAM NAME="_ExtentY" VALUE="661">
                        <PARAM NAME="_StockProps" VALUE="13">
                        <PARAM NAME="ForeColor" VALUE="0">
                        <PARAM NAME="BackColor" VALUE="16777215">
                        <PARAM NAME="MainProductID" VALUE="">
                        <param name="Lgg" value="Chinese">
                        <param name="ClientInner_DLL" value="ClientInner.dll">
                        <param name="ClientInner_Version" value="3.0.0.11">
                        <param name="URL_NSServer" value="http://127.0.0.1:8088/NSServer/default.aspx">
                        <param name="MainProductID" value="G6">
                        <param name="URL_Shortcut" value="">
                        <param name="inifile" value="Modules.ini">
                        <font color="#000000" face="宋体" size="3">
                            无法下载、运行新中大客户端控件<br>
                            请在 "Internet选项"中降低安全级别，使得ActiveX控件允许被下载，然后重新刷新本页<br> 
                            或者点<a href="~/Resource/UsbKeyEnvSetup.exe">客户端安装程序</a>，下载,运行该程序即可.
                        </font>
                    </object>
                    
                    <object id="USBVal" height="0" width="0" classid="clsid:1CF267CC-953F-4B27-A7E7-42A8769A903A"
                            viewastext>
                        <param name="_Version" value="65536">
                        <param name="_ExtentX" value="26">
                        <param name="_ExtentY" value="26">
                        <param name="_StockProps" value="0">
                    </object>
                </td>
            </tr>
            <tr></tr>
        </table>

</div>

<div class="row" style="left:45px!important;right:45px!important;">
    <div class="col-lg-4">
        <h3>&nbsp;&nbsp;支付单列表</h3>
        <p>
            <button id="getList">获取列表 OK</button>
        </p>

        <p>
            <button id="getList4Zjbf">获取资金拨付支付单列表 OK</button>
        </p>

        <br>
        <h3>&nbsp;&nbsp;支付单维护</h3>
        <p>
            <button id="newPayment">新增支付单 OK</button>
            <br>
            <br>

            <input id="getPhid" type="text" style="width:50%;">
            <button id="getPayment">获取资金拨付支付单 OK</button>
            <br>
            <br>

            <input id="delPhid" type="text" style="width:50%;">
            <button id="deletePayment">删除支付单 OK</button>
            <br>
            <br>

            <button id="getBankServiceState">检查银行服务状态</button>
            <br>
            <br>

            <input id="payPhid" type="text" style="width:50%;">
            <button id="singlePay">单笔支付</button>
            <br>
            <br>

            <input id="getPayStatePhid" type="text" style="width:50%;">
            <button id="getPayState">获取支付单支付状态</button>
            <br>
            <br>

            <input id="unionPayPhids" type="text" style="width:50%;">
            <button id="unionPay">合并支付</button>
            <br>
            <br>

            <input id="refreshPayPhids" type="text" style="width:50%;">
            <button id="refreshPaymentsState">批量刷新支付状态</button>
            <br>
            <br>

            <input id="updatePayPhids" type="text" style="width:50%;">
            <button id="updatePaymentsState">批量更新支付状态</button>
            <br>
            <br>

            <button id="dealException">处理支付异常</button>
        </p>

        <br>
        <h3>&nbsp;&nbsp;银行Api</h3>
        <button id="getBalance">查询余额</button>
        <br>
        <br>
        <button id="submitPayment">提交支付</button>
        <br>
        <br>

        <input id="fSeqNo" type="text" style="width:50%;" value="1905100946MQP3@PE">
        <button id="getPaymentState">查询支付状态</button>
        <br>
        <br>

        <button id="getCurrentDetails">查询当日明细</button>
        <br>
        <br>

        <button id="getHistoryDetails">查询历史明细</button>
    </div>

    <div class="col-lg-4">
        <h3>请求参数</h3>
        <textarea id="requst" rows=22></textarea>
    </div>

    <div class="col-lg-4">
        <h3>响应结果</h3>
        <textarea id="response" rows=22></textarea>
    </div>
</div>

<!--
<div class="row" style="left:25px!important;right:25px!important;">
    <div class="col-md-4">
        <h2>&nbsp;&nbsp;其他</h2>
        <button id="test">测试接口</button>
        <button id="test2">测试接口2</button>

        <p>
            <form enctype="multipart/form-data">
                <input id="upload_file" name="file" type="file" />
                <input id="upload_file2" name="file2" type="file" />
                <input id="upload_file3" name="file3" type="file" />
                <button id="aa" type="button" onclick="upFile()">提交</button>
            </form>
        </p>
    </div>
</div>
-->

<script src="@Url.Content("~/Scripts/jquery-2.1.1.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.base64.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.md5.js")" type="text/javascript"></script>

<script type="text/javascript">

    var appKey = 'D31B7F91-3068-4A49-91EE-F3E13AE5C48C',
        appSecret = '103CB639-840C-4E4F-8812-220ECE3C4E4D',
        url = "http://127.0.0.1:8081",
        reqTimeStamp = Date.parse(new Date());
    var sign = $.md5((url + reqTimeStamp + appKey + appSecret).toLowerCase());
    var items = [sign, url, reqTimeStamp, appKey];
    var configData = [];

    var appinfo = {
        'DbName': 'NG0002', //13.168->Ng0001,  127.0.0.1->NG0002
        'OrgId': '547181121000001',
        'OrgName': '',
        'OCode': '',
        'UserId': '521180820000001',
        'UserKey': '9999',
        'UserName': '',
        'TokenKey': '',
        'AppKey': appKey,
        'AppSecret': appSecret,
        'DbServerName': '',
        'SessionKey': '',
        'UName': ''
    };

    $(function () {
        //获取列表
        $("#getList").bind('click', function () {
            alert("获取列表");

            /*
            queryfilter说明，如果不需要条件时, 可不包括任何查询字段信息，比如要查询全部，则queryfilte:''即可

            FBilltype*str*eq*1：         单据类型： zjbf 资金拨付单
			NgInsertDt*date*ge*1：       申报日期起
			NgInsertDt*date*le*1：       申报日期止
			FApproval*byte*eq*1：        审批状态 0-未审批
			FState*byte*eq*1：           支付状态
            [or-dictionary0]*dictionary*or: 关联单据号或支付单号-> (RefbillCode*str*like*1：关联单据号 FCode*str*like*1：支付单号) 双引号中对应的值即为要搜索的值
			*/
            var data = {
                queryfilter: '{"FBilltype*str*eq*1":"zjbf","NgInsertDt*date*ge*1":"2018-12-01","NgInsertDt*date*le*1":"2019-12-20 10:59:59","FApproval*byte*eq*1":0,"FState*byte*eq*1":0,"[or-dictionary0]*dictionary*or":{"RefbillCode*str*like*1":"zfbf","FCode*str*like*1":"P"}}',            //查询条件
                PageIndex: 0,               //当前第几页,从0开始
                PageSize: 3,                //每页显示行数
                uid: '521180820000001',     //用户id
                orgid: '547181121000001',   //组织id
                ryear: '2019'               //年度
            };

            var send = JSON.stringify(data);
            $('#requst').text(send);

            $.ajax({
                headers: {
                    'Accept': "multipart/form-data; charset=utf-8",
                    'AppInfo': $.base64.encode(JSON.stringify(appinfo)),
                    'Sign': items
                },
                type: 'get',
                url: '@Url.Content("~/api/GGK/GKPaymentMstApi/GetPaymentList")',
                data: data,
                datatype: 'json',
                success: function (data, textstatus) {
                    console.log(JSON.parse(data));
                    $('#response').text(data);
                },
                error: function (xmlhttprequest, textstatus, errorThrown) {
                    $('#response').text(xmlhttprequest.responseText);
                }
            });
        });

        //获取资金拨付支付单列表
        $("#getList4Zjbf").bind('click', function () {
            alert("获取列表");

            /*
            queryfilter说明，如果不需要条件时, 可不包括任何查询字段信息，比如要查询全部，则queryfilte:''即可

            FBilltype*str*eq*1：         单据类型： zjbf 资金拨付单
			NgInsertDt*date*ge*1：       申报日期起
			NgInsertDt*date*le*1：       申报日期止
			FApproval*byte*eq*1：        审批状态 0-未审批
			FState*byte*eq*1：           支付状态
            [or-dictionary0]*dictionary*or: 关联单据号或支付单号-> (RefbillCode*str*like*1：关联单据号 FCode*str*like*1：支付单号) 双引号中对应的值即为要搜索的值
			*/
            var data = {
                queryfilter: '{"FBilltype*str*eq*1":"zjbf","NgInsertDt*date*ge*1":"2018-12-01","NgInsertDt*date*le*1":"2019-12-20 10:59:59","FApproval*byte*eq*1":0,"FState*byte*eq*1":0,"[or-dictionary0]*dictionary*or":{"RefbillCode*str*like*1":"zfbf","FCode*str*like*1":"P"}}',            //查询条件
                PageIndex: 0,               //当前第几页,从0开始
                PageSize: 3,                //每页显示行数
                uid: '521180820000001',     //用户id
                orgid: '547181121000001',   //组织id
                ryear: '2019'               //年度
            };

            var send = JSON.stringify(data);
            $('#requst').text(send);

            $.ajax({
                headers: {
                    'Accept': "multipart/form-data; charset=utf-8",
                    'AppInfo': $.base64.encode(JSON.stringify(appinfo)),
                    'Sign': items
                },
                type: 'get',
                url: '@Url.Content("~/api/GGK/GKPaymentMstApi/GetPaymentList4Zjbf")',
                data: data,
                datatype: 'json',
                success: function (data, textstatus) {
                    console.log(JSON.parse(data));
                    $('#response').text(data);
                },
                error: function (xmlhttprequest, textstatus, errorThrown) {
                    $('#response').text(xmlhttprequest.responseText);
                }
            });
        });

        //新增支付单
        $("#newPayment").bind('click', function () {
            alert("新增支付单");

            /*
            Mst: 主表数据
            Dtls： 明细表数据，数组

            PersistentState = 1 表示新增
			*/
            var now = new Date().getTime().toString();
            var addData = {
                "uid": 521180820000001,     //用户id
                "orgid": 547181121000001,   //组织id
                "ryear": '2019',               //年度
                "infoData": {
                    "Mst": {
                        "PhId": 0,
                        "OrgPhid": 547181121000001,
                        "OrgCode": "100",
                        "RefbillPhid": 7,
                        "RefbillCode": "zfbbf0007",
                        "FCode": "P" + now,
                        "FPaymethod": 2,
                        "FAmountTotal": 2006.0,
                        "FApproval": 0,
                        "FState": 0,
                        "FDescribe": "单元测试-" + now,
                        "FDate": "2019-05-28",
                        "FBilltype": "zjbf",
                        "PersistentState": 1
                    },
                    "Dtls": [{
                        "PhId": 0,
                        "MstPhid": 0,
                        "OrgPhid": 521180820000002,
                        "OrgCode": "100",
                        "RefbillPhid": 7,
                        "RefbillCode": "zfbbf0007",
                        "RefbillDtlPhid": 1,
                        "RefbillDtlPhid2": 1,
                        "FAmount": 1000.0,
                        "FCurrency": "001",
                        "FPayAcntname": "菌邢票董租氮蒸幻憨野该痼赴挥傻",
                        "FPayAcnt": "1202022719927388888",
                        "FPayBankcode": "102",
                        "FRecAcntname": "菌邢票董租氮蒸野该挥傻摘灌莉犹冤越憨少莲晰挥傻",
                        "FRecAcnt": "1202051309900024733",
                        "FRecBankcode": "102",
                        "FRecCityname": "杭州市",
                        "FSamecity": 1,
                        "FSamebank": 1,
                        "FIsurgent": 1,
                        "FCorp": 1,
                        "FUsage": "用途信息",
                        "FPostscript": "附言：xxx",
                        "FExplation": "摘要",
                        "FDescribe": "描述",
                        "FSubmitdate": null,
                        "FSeqno": null,
                        "FBkSn": null,
                        "FResult": null,
                        "FResultmsg": null,
                        "FState": 0,
                        "FNewCode": null,
                        "ForeignKeys": null,
                        "BusinessPrimaryKeys": null,
                        "QtKmdm": "401",
                        "QtKmmc": "会费收入",
                        "PersistentState": 1
                    }, {
                        "PhId": 0,
                        "MstPhid": 0,
                        "OrgPhid": 521180820000002,
                        "OrgCode": "100",
                        "RefbillPhid": 7,
                        "RefbillCode": "zfbbf0007",
                        "RefbillDtlPhid": 2,
                        "RefbillDtlPhid2": 2,
                        "FAmount": 1006.0,
                        "FCurrency": "001",
                        "FPayAcntname": "菌邢票董租氮蒸幻憨野该痼赴挥傻",
                        "FPayAcnt": "1202022719927388888",
                        "FPayBankcode": "102",
                        "FRecAcntname": "菌邢科吓令它野该挥傻",
                        "FRecAcnt": "1205270019200803293",
                        "FRecBankcode": "102",
                        "FRecCityname": "杭州市",
                        "FSamecity": 1,
                        "FSamebank": 1,
                        "FIsurgent": 1,
                        "FCorp": 1,
                        "FUsage": "用途信息2",
                        "FPostscript": "附言：xxx2",
                        "FExplation": "摘要2",
                        "FDescribe": "描述2",
                        "FSubmitdate": null,
                        "FSeqno": null,
                        "FBkSn": null,
                        "FResult": null,
                        "FResultmsg": null,
                        "FState": 0,
                        "FNewCode": null,
                        "QtKmdm": "402",
                        "QtKmmc": "拨缴经费收入",
                        "PersistentState": 1
                    }
                    ]
                }
            };

            var addData2 = {
                "uid": 521180820000001,     //用户id
                "orgid": 547181121000001,   //组织id
                "ryear": '2019',               //年度
                "infoData": {
                    "Mst": {
                        "PhId": 0,
                        "OrgPhid": 547181121000001,
                        "OrgCode": "100",
                        "RefbillPhid": 7,
                        "RefbillCode": "zfbbf0007",
                        "FCode": "P" + now,
                        "FPaymethod": 2,
                        "FAmountTotal": 143.0,
                        "FApproval": 0,
                        "FState": 0,
                        "FDescribe": "单元测试-" + now,
                        "FDate": "2019-05-28",
                        "FBilltype": "zjbf",
                        "PersistentState": 1
                    },
                    "Dtls": [{
                        "PhId": 0,
                        "MstPhid": 0,
                        "OrgPhid": 521180820000002,
                        "OrgCode": "100",
                        "RefbillPhid": 7,
                        "RefbillCode": "zfbbf0007",
                        "RefbillDtlPhid": 1,
                        "RefbillDtlPhid2": 1,
                        "FAmount": 143.0,
                        "FCurrency": "001",
                        "FPayAcntname": "菌邢票董租氮蒸幻憨野该痼赴挥傻",
                        "FPayAcnt": "1202022719927388888",
                        "FPayBankcode": "102",
                        "FRecAcntname": "菌邢票董租氮蒸野该挥傻摘灌莉犹冤越憨少莲晰挥傻",
                        "FRecAcnt": "1202051309900024733",
                        "FRecBankcode": "102",
                        "FRecCityname": "杭州市",
                        "FSamecity": 1,
                        "FSamebank": 1,
                        "FIsurgent": 1,
                        "FCorp": 1,
                        "FUsage": "用途信息",
                        "FPostscript": "附言：xxx",
                        "FExplation": "摘要",
                        "FDescribe": "描述",
                        "FSubmitdate": null,
                        "FSeqno": null,
                        "FBkSn": null,
                        "FResult": null,
                        "FResultmsg": null,
                        "FState": 0,
                        "FNewCode": null,
                        "ForeignKeys": null,
                        "BusinessPrimaryKeys": null,
                        "QtKmdm": "401",
                        "QtKmmc": "会费收入",
                        "PersistentState": 1
                        }
                    ]
                }
            };

            var send = JSON.stringify(addData);
            $('#requst').text(send);

            $.ajax({
                headers: {
                    'Accept': "multipart/form-data; charset=utf-8",
                    'AppInfo': $.base64.encode(JSON.stringify(appinfo)),
                    'Sign': items
                },
                type: 'post',
                url: '@Url.Content("~/api/GGK/GKPaymentMstApi/PostAdd")',
                data: addData,
                datatype: 'json',
                success: function (data, textstatus) {
                    console.log(JSON.parse(data));
                    $('#response').text(data);
                },
                error: function (xmlhttprequest, textstatus, errorThrown) {
                    $('#response').text(xmlhttprequest.responseText);
                }
            });
        });


        //获取支付单
        $("#getPayment").bind('click', function () {
            alert("获取支付单");

            var phid = $('#getPhid').val();

            if (phid == "" | phid == undefined) {
                alert("请输入支付单phid!");
                return;
            }
            
            var data = {
                id: phid,      //支付单的Phid 401190528000001 372190527000004 325190528000002 213190529000001
                uid: '521180820000001',     //用户id
                orgid: '547181121000001',   //组织id
                ryear: '2019'               //年度
            };

            var send = JSON.stringify(data);
            $('#requst').text(send);

            $.ajax({
                headers: {
                    'Accept': "multipart/form-data; charset=utf-8",
                    'AppInfo': $.base64.encode(JSON.stringify(appinfo)),
                    'Sign': items
                },
                type: 'get',
                url: '@Url.Content("~/api/GGK/GKPaymentMstApi/GetPayment4Zjbf")',
                data: data,
                datatype: 'json',
                success: function (data, textstatus) {
                    console.log(JSON.parse(data));
                    $('#response').text(data);
                },
                error: function (xmlhttprequest, textstatus, errorThrown) {
                    $('#response').text(xmlhttprequest.responseText);
                }
            });
        });

        //删除支付单
        $("#deletePayment").bind('click', function () {
            alert("删除支付单");

            var phid = $('#delPhid').val();

            if (phid == "" | phid == undefined) {
                alert("请输入支付单phid!");
                return;
            }

            var data = {
                id: phid,      //支付单的Phid 401190528000001 372190527000004 325190528000002
                uid: '521180820000001',     //用户id
                orgid: '547181121000001',   //组织id
                ryear: '2019'               //年度
            };

            var send = JSON.stringify(data);
            $('#requst').text(send);

            $.ajax({
                headers: {
                    'Accept': "multipart/form-data; charset=utf-8",
                    'AppInfo': $.base64.encode(JSON.stringify(appinfo)),
                    'Sign': items
                },
                type: 'post',
                url: '@Url.Content("~/api/GGK/GKPaymentMstApi/PostDelete")',
                data: data,
                datatype: 'json',
                success: function (data, textstatus) {
                    console.log(JSON.parse(data));
                    $('#response').text(data);
                },
                error: function (xmlhttprequest, textstatus, errorThrown) {
                    $('#response').text(xmlhttprequest.responseText);
                }
            });
        });

        //单笔支付
        $("#singlePay").bind('click', function () {
            alert("单笔支付");

            var phid = $('#payPhid').val();

            if (phid == "" | phid == undefined) {
                alert("请输入支付单phid!");
                return;
            }

            var data = {
                id: phid,      //支付单的Phid 
                uid: '521180820000001',     //用户id
                orgid: '547181121000001',   //组织id
                ryear: '2019'               //年度
            };

            var send = JSON.stringify(data);
            $('#requst').text(send);

            $.ajax({
                headers: {
                    'Accept': "multipart/form-data; charset=utf-8",
                    'AppInfo': $.base64.encode(JSON.stringify(appinfo)),
                    'Sign': items
                },
                type: 'post',
                url: '@Url.Content("~/api/GGK/GKPaymentMstApi/PostSubmitPayment")',
                data: data,
                datatype: 'json',
                success: function (data, textstatus) {
                    console.log(JSON.parse(data));
                    $('#response').text(data);
                },
                error: function (xmlhttprequest, textstatus, errorThrown) {
                    $('#response').text(xmlhttprequest.responseText);
                }
            });
        });

        //获得银行服务状态
        $("#getBankServiceState").bind('click', function () {
            alert("获得银行服务状态");
            

            $.ajax({
                headers: {
                    'Accept': "multipart/form-data; charset=utf-8",
                    'AppInfo': $.base64.encode(JSON.stringify(appinfo)),
                    'Sign': items
                },
                type: 'get',
                url: '@Url.Content("~/api/GGK/GKPaymentMstApi/GetBankServiceState")',
                data: "",
                datatype: 'json',
                success: function (data, textstatus) {
                    console.log(JSON.parse(data));
                    $('#response').text(data);
                },
                error: function (xmlhttprequest, textstatus, errorThrown) {
                    $('#response').text(xmlhttprequest.responseText);
                }
            });
        });


        //刷新支付单支付状态
        $("#getPayState").bind('click', function () {
            alert("获取支付单支付状态");

            var phid = $('#getPayStatePhid').val();

            if (phid == "" | phid == undefined) {
                alert("请输入支付单phid!");
                return;
            }

            var data = {
                id: phid,      //支付单的Phid 
                uid: '521180820000001',     //用户id
                orgid: '547181121000001',   //组织id
                ryear: '2019'               //年度
            };

            var send = JSON.stringify(data);
            $('#requst').text(send);

            $.ajax({
                headers: {
                    'Accept': "multipart/form-data; charset=utf-8",
                    'AppInfo': $.base64.encode(JSON.stringify(appinfo)),
                    'Sign': items
                },
                type: 'post',
                url: '@Url.Content("~/api/GGK/GKPaymentMstApi/PostRefreshPaymentState")',
                data: data,
                datatype: 'json',
                success: function (data, textstatus) {
                    console.log(JSON.parse(data));
                    $('#response').text(data);
                },
                error: function (xmlhttprequest, textstatus, errorThrown) {
                    $('#response').text(xmlhttprequest.responseText);
                }
            });
        });

        //合并支付
        $("#unionPay").bind('click', function () {
            alert("合并支付");

            var phids = $('#unionPayPhids').val();

            if (phids == "" | phids == undefined) {
                alert("请输入支付单phid,多个支付单phid使用逗号(,)分隔!");
                return;
            }
            var ids = phids.split(",");

            var data = {                
                uid: '521180820000001',     //用户id
                orgid: '547181121000001',   //组织id
                ryear: '2019',               //年度
                infoData: ids
            };

            var send = JSON.stringify(data);
            $('#requst').text(send);

            $.ajax({
                headers: {
                    'Accept': "multipart/form-data; charset=utf-8",
                    'AppInfo': $.base64.encode(JSON.stringify(appinfo)),
                    'Sign': items
                },
                type: 'post',
                url: '@Url.Content("~/api/GGK/GKPaymentMstApi/PostSubmitPayments")',
                data: data,
                datatype: 'json',
                success: function (data, textstatus) {
                    console.log(JSON.parse(data));
                    $('#response').text(data);
                },
                error: function (xmlhttprequest, textstatus, errorThrown) {
                    $('#response').text(xmlhttprequest.responseText);
                }
            });
        });


        //批量刷新支付单支付状态
        $("#refreshPaymentsState").bind('click', function () {
            alert("批量刷新支付单支付状态");

            var phids = $('#refreshPayPhids').val();

            if (phids == "" | phids == undefined) {
                alert("请输入支付单phid,多个支付单phid使用逗号(,)分隔!");
                return;
            }
            var ids = phids.split(",");

            var data = {
                uid: '631181115000001',
                orgid: '547181121000001',
                infoData: ids
            };

            var send = JSON.stringify(data);
            $('#requst').text(send);

            $.ajax({
                headers: {
                    'Accept': "multipart/form-data; charset=utf-8",
                    'AppInfo': $.base64.encode(JSON.stringify(appinfo)),
                    'Sign': items
                },
                type: 'post',
                url: '@Url.Content("~/api/GGK/GKPaymentMstApi/PostRefreshPaymentsState")',
                data: data,
                datatype: 'json',
                success: function (data, textstatus) {
                    console.log(JSON.parse(data));
                    $('#response').text(data);
                },
                error: function (xmlhttprequest, textstatus, errorThrown) {
                    $('#response').text(xmlhttprequest.responseText);
                }
            });
        });


        //批量更新支付单支付状态
        $("#updatePaymentsState").bind('click', function () {
            alert("批量更新支付单支付状态");

            var phids = $('#updatePayPhids').val();

            if (phids == "" | phids == undefined) {
                alert("请输入支付单phid,多个支付单phid使用逗号(,)分隔!");
                return;
            }
            var ids = phids.split(",");

            var data = {
                uid: '631181115000001',
                orgid: '547181121000001',
                infoData: ids,
                value: 1
            };

            var send = JSON.stringify(data);
            $('#requst').text(send);

            $.ajax({
                headers: {
                    'Accept': "multipart/form-data; charset=utf-8",
                    'AppInfo': $.base64.encode(JSON.stringify(appinfo)),
                    'Sign': items
                },
                type: 'post',
                url: '@Url.Content("~/api/GGK/GKPaymentMstApi/PostUpdatePaymentsState")',
                data: data,
                datatype: 'json',
                success: function (data, textstatus) {
                    console.log(JSON.parse(data));
                    $('#response').text(data);
                },
                error: function (xmlhttprequest, textstatus, errorThrown) {
                    $('#response').text(xmlhttprequest.responseText);
                }
            });
        });


        //银行api：查询余额
        $('#getBalance').click(function () {
            var today = "2019-05-08";
            var bankInfo = { bankCode: '102', bankName: '工商银行', shortName: 'ICBC', bankKeys: '工行', description: '中国工商银行' };
            var bankVersion = { versionName: '工商银行NC版', shortName: 'ICBCNC', vendor: '杭州政云数据技术有限公司' };

            var data = {
                currency: '', //工行： 001 表示人民币
                beginDate: today,
                endDate: today,
                caller: {
                    caller: 'web', version: '0.1beta', callerIP: '', callerOS: '', callerTime: today
                },
                infoData: {
                    bankName: '工商银行',
                    acntNo: '1202022719927388888',
                    acntName: '菌邢票董租氮蒸幻憨野该痼赴挥傻',
                    swiftCode: '102',
                    country: '中国',
                    province: '浙江',
                    city: '杭州',
                    bankInfo: bankInfo,
                    bankVersionInfo: bankVersion,
                    CertUserID: 'nc312019.y.1202'
                }
            };

            var send = JSON.stringify(data);
            $('#requst').text(send);

            $.ajax({
                type: 'post',
                url: '@Url.Content("~/api/BIF/BankService/PostGetBalance")',
                data: data,
                datatype: 'json',
                success: function (ret, textstatus) {
                    $('#response').text(ret);
                },
                error: function (xmlhttprequest, textstatus, errorThrown) {
                    $('#response').text(xmlhttprequest.responseText);
                }
            });
        });

        //银行api：支付
        $('#submitPayment').click(function () {
            var today = "2019-05-08";
            var bankInfo = { bankCode: '102', bankName: '工商银行', shortName: 'ICBC', bankKeys: '工行', description: '中国工商银行' };
            var bankVersion = { versionName: '工商银行NC版', shortName: 'ICBCNC', vendor: '杭州政云数据技术有限公司' };
            var bankAcnt = {
                    bankName: '工商银行',
                    acntNo: '1202022719927388888',
                    acntName: '菌邢票董租氮蒸幻憨野该痼赴挥傻',
                    swiftCode: '102',
                    country: '中国',
                    province: '浙江',
                    city: '杭州',
                    bankInfo: bankInfo,
                    bankVersionInfo: bankVersion,
                    CertUserID: ''
                };
            var oppoBankAcnt = {
                    bankName: '工商银行',
                    acntNo: '1202051309900024733',
                    acntName: '菌邢票董租氮蒸野该挥傻摘灌莉犹冤越憨少莲晰挥傻',
                    swiftCode: '102',
                    country: '中国',
                    province: '浙江',
                    city: '杭州',
                    bankInfo: bankInfo,
                    bankVersionInfo: bankVersion,
                    CertUserID: ''
                };

            var oppoBankAcnt2 = {
                    bankName: '工商银行',
                    acntNo: '1205270019200803293',
                    acntName: '菌邢科吓令它野该挥傻',
                    swiftCode: '102',
                    country: '中国',
                    province: '浙江',
                    city: '杭州',
                    bankInfo: bankInfo,
                    bankVersionInfo: bankVersion,
                    CertUserID: ''
                };

            var data = {
                currency: '', //工行： 001 表示人民币
                beginDate: today,
                endDate: today,
                caller: {
                    caller: 'web', version: '0.1beta', callerIP: '', callerOS: '', callerTime: today
                },
                infoData: [{
                    packageID: 0,
                    bankAcnt: bankAcnt,
                    oppoBankAcnt: oppoBankAcnt,
                    amount: 100,
                    currency: '001',
                    bookingDate: '',
                    submitDate: '',
                    sameCity: 1,
                    sameBank: 1,
                    isUrgent: 1,
                    payState: '',
                    explantion: 'GData支付测试001',
                    usage: 'Gdata上线测试',
                    submitterID: '9999',
                    businessRefNo: 'GData'
                },
                {
                    packageID: 0,
                    bankAcnt: bankAcnt,
                    oppoBankAcnt: oppoBankAcnt2,
                    amount: 150,
                    currency: '001',
                    bookingDate: '',
                    submitDate: '',
                    sameCity: 1,
                    sameBank: 1,
                    isUrgent: 1,
                    payState: '',
                    explantion: 'GData支付测试002',
                    usage: 'Gdata上线测试',
                    submitterID: '9999',
                    businessRefNo: 'GData'
                }
              ]
            };

            var send = JSON.stringify(data);
            $('#requst').text(send);

            $.ajax({
                type: 'post',
                url: '@Url.Content("~/api/BIF/BankService/PostSubmitPayment")',
                data: data,
                datatype: 'json',
                success: function (ret, textstatus) {
                    $('#response').text(ret);
                    if (ret!=undefined)                    {
                        var seqNo = JSON.parse(ret).Data.fSeqno;
                        $('#fSeqNo').val(seqNo);
                    }
                },
                error: function (xmlhttprequest, textstatus, errorThrown) {
                    $('#response').text(xmlhttprequest.responseText);
                }
            });
        });


        //银行api：查询支付状态
        $('#getPaymentState').click(function () {
            var today = "2019-05-08";
            var seqNo = $('#fSeqNo').val();

            if (seqNo =="" | seqNo==undefined)
            {
                alert("请输入支付序列号!");
                return;
            }

            var bankInfo = { bankCode: '102', bankName: '工商银行', shortName: 'ICBC', bankKeys: '工行', description: '中国工商银行' };
            var bankVersion = { versionName: '工商银行NC版', shortName: 'ICBCNC', vendor: '杭州政云数据技术有限公司' };

            var data = {
                currency: '', //工行： 001 表示人民币
                beginDate: today,
                endDate: today,
                fSeqNo: seqNo,  //1905100946MQP3@PE  1905100925MQP3@PE 1905131512EHTW@PE 1905131702MP03@PE 1905141309X9VL@PE
                caller: {
                    caller: 'web', version: '0.1beta', callerIP: '', callerOS: '', callerTime: today
                },
                infoData: bankVersion
            };

            var send = JSON.stringify(data);
            $('#requst').text(send);

            $.ajax({
                type: 'post',
                url: '@Url.Content("~/api/BIF/BankService/PostGetPaymentState")',
                data: data,
                datatype: 'json',
                success: function (ret, textstatus) {
                    $('#response').text(ret);
                },
                error: function (xmlhttprequest, textstatus, errorThrown) {
                    $('#response').text(xmlhttprequest.responseText);
                }
            });
        });


        //银行api：查询当前交易明细
        $('#getCurrentDetails').click(function () {
            var today = "2019-05-08";
            var bankInfo = { bankCode: '102', bankName: '工商银行', shortName: 'ICBC', bankKeys: '工行', description: '中国工商银行' };
            var bankVersion = { versionName: '工商银行NC版', shortName: 'ICBCNC', vendor: '杭州政云数据技术有限公司' };

            var data = {
                currency: '', //工行： 001 表示人民币
                beginDate: today,
                endDate: today,
                caller: {
                    caller: 'web', version: '0.1beta', callerIP: '', callerOS: '', callerTime: today
                },
                minAmt: 0,
                maxAmt: 100,
                nextTag: '',
                infoData: {
                    bankName: '工商银行',
                    acntNo: '1202022719927388888',
                    acntName: '菌邢票董租氮蒸幻憨野该痼赴挥傻',
                    swiftCode: '102',
                    country: '中国',
                    province: '浙江',
                    city: '杭州',
                    bankInfo: bankInfo,
                    bankVersionInfo: bankVersion,
                    CertUserID: 'nc312019.y.1202'
                }
            };

            var send = JSON.stringify(data);
            $('#requst').text(send);

            $.ajax({
                type: 'post',
                url: '@Url.Content("~/api/BIF/BankService/PostGetCurrentDetails")',
                data: data,
                datatype: 'json',
                success: function (ret, textstatus) {
                    $('#response').text(ret);
                },
                error: function (xmlhttprequest, textstatus, errorThrown) {
                    $('#response').text(xmlhttprequest.responseText);
                }
            });
        });


        //银行api：查询历史交易明细
        $('#getHistoryDetails').click(function () {
            var beginDate = "2019-04-25";
            var endDay = "2019-05-31";
            var bankInfo = { bankCode: '102', bankName: '工商银行', shortName: 'ICBC', bankKeys: '工行', description: '中国工商银行' };
            var bankVersion = { versionName: '工商银行NC版', shortName: 'ICBCNC', vendor: '杭州政云数据技术有限公司' };

            var data = {
                currency: '', //工行： 001 表示人民币
                beginDate: beginDate,
                endDate: endDay,
                caller: {
                    caller: 'web', version: '0.1beta', callerIP: '', callerOS: '', callerTime: beginDate
                },
                minAmt: 0,
                maxAmt: 100,
                nextTag: '',
                infoData: {
                    bankName: '工商银行',
                    acntNo: '1202022719927388888',
                    acntName: '菌邢票董租氮蒸幻憨野该痼赴挥傻',
                    swiftCode: '102',
                    country: '中国',
                    province: '浙江',
                    city: '杭州',
                    bankInfo: bankInfo,
                    bankVersionInfo: bankVersion,
                    CertUserID: 'nc312019.y.1202'
                }
            };

            var send = JSON.stringify(data);
            $('#requst').text(send);

            $.ajax({
                type: 'post',
                url: '@Url.Content("~/api/BIF/BankService/PostGetHistoryDetails")',
                data: data,
                datatype: 'json',
                success: function (ret, textstatus) {
                    $('#response').text(ret);
                },
                error: function (xmlhttprequest, textstatus, errorThrown) {
                    $('#response').text(xmlhttprequest.responseText);
                }
            });
        });


        $("#test").bind('click', function () {

            var data = {
                queryfilter: '',
                PageIndex: 1,
                PageSize: 20,
            };

            $.ajax({
                headers: {
                    'Accept': "multipart/form-data; charset=utf-8",
                    'AppInfo': $.base64.encode(JSON.stringify(appinfo)),
                    'Sign': items
                },
                type: 'get',
                url: '@Url.Content("~/api/GQT/BudgetAccountsApi/GetBudgetAccountsList")',
                data: data,
                datatype: 'json',
                success: function (data, textstatus) {
                    console.log(JSON.parse(data));
                },
                error: function (xmlhttprequest, textstatus, errorThrown) {

                }
            });
        });

        $("#test2").bind('click', function () {

            var info = {
                'Author': 'xiaowang',
                'Phone': '13587381870',
                'Description': '很严峻',
                'IsFinish': '0',
            };
            var data = {
                uid: '631181115000001',
                orgid: '547181121000001',
                infoData: configData
            };

            $.ajax({
                headers: {
                    'Accept': "multipart/form-data; charset=utf-8",
                    'AppInfo': $.base64.encode(JSON.stringify(appinfo)),
                    'Sign': items
                },
                type: 'post',
                url: '@Url.Content("~/api/GCW/SysConfig/PostUpdate")',
                data: data,
                datatype: 'json',
                success: function (data, textstatus) {
                    alert(data);
                },
                error: function (xmlhttprequest, textstatus, errorThrown) {

                }
            });
        });


        $("#searchUSB").bind("click", SearchUSB);

        function getSecCode() {
            var secCode;
            var usbType;
            var icCardNo;

            if (needUSB == "Y") {
                usbType = document.all["hd_HardWareType"].value;	//得到硬件加密方式

                if (usbType == "0") {
                    try {
                        secCode = document.all("USBVal").getcode();
                    }
                    catch (e) {
                        secCode = "error";
                    }

                    if (secCode != "error") {
                        document.all["TB_SecCode"].value = secCode;
                        document.all["TB_SecCode"].setAttribute("value", secCode);
                    }
                }
                else {
                    icCardNo = document.all("USBVal").jl(3);
                    document.all["hd_hardwareCode"].value = icCardNo;
                    document.all["hd_hardwareCode"].setAttribute("value", icCardNo);
                    if (icCardNo == "0") {
                        alert(document.all("USBVal").getlasterror());
                        return false;
                    }

                }

            }

            return true;
        }

        // USB身份登录检索
        function SearchUSB() {
            var seedCode;
            var retuCode;
            var usbType;
            var icCardNo;
            var strMsg = "";

            //				document.all("AF").run("LForm","1","");
            //debugger;
            usbType = 0; //document.all["hd_HardWareType"].value;	//得到硬件加密方式

            if (usbType == "0") {
                seedCode = 13858029;
                try {
                    retuCode = document.all("USBVal").init(seedCode);
                }
                catch (e) {
                    retuCode = -1;
                }

                switch (retuCode) {
                    case 1:
                        //							window.alert(Inter_NoInstall);
                        strMsg = "加密锁驱动程序未安装";
                        break;
                    case 2:
                        //							window.alert(Inter_LockError);
                        strMsg = "加密锁I/O错误";
                        break;

                    case 3:
                        //							window.alert(Inter_NOLock);
                        strMsg = "未插有加密锁";
                        break;
                    case 4:
                        //							window.alert(Inter_ManyLock);
                        strMsg = "插有多把加密锁";
                        break;
                    case -1:
                        //							window.alert(Inter_StartError);
                        strMsg = "加密锁读取失败";
                        break;
                }
            }
            else {
                icCardNo = document.all("USBVal").jl(3);

                if (icCardNo == "0") {
                    strMsg = document.all("USBVal").getlasterror();
                }
            }


            try {
                //document.all["hd_IsExistUSB"].value = strMsg;
               // document.all["hd_IsExistUSB"].setAttribute("value", strMsg);

                var userId = document.all("USBVal").getuid();
                //document.all["hd_UserID"].value = userId;
                //document.all["hd_UserID"].setAttribute("value", userId);

                var secCode;
                //				var secCode = document.all("USBVal").getcode();
                //				document.all["TB_SecCode"].value = secCode;
                //				document.all["TB_SecCode"].setAttribute("value",secCode);
                secCode = document.all("USBVal").getcode();


                var md5ID = $.md5(userId);

                alert(userId + ", " + secCode + ", Md5LockId=" + md5ID);
            }
            catch (e) {
                secCode = "error";
            }

            //if (secCode != "error") {
            //    document.all["TB_SecCode"].value = secCode;
            //    document.all["TB_SecCode"].setAttribute("value", secCode);
            //}
        }

        //获取是否启用支付加密狗
        $("#getPayUsbKeyState").bind("click", function () {
            alert("获取是否启用支付加密狗");

            var user_phid = "521180820000002"; //"488181024000001";


            var data = {
                uid: user_phid,
                orgid: '547181121000001'
            };

            var send = JSON.stringify(data);
            $('#requst').text(send);

            $.ajax({
                headers: {
                    'Accept': "multipart/form-data; charset=utf-8",
                    'AppInfo': $.base64.encode(JSON.stringify(appinfo)),
                    'Sign': items
                },
                type: 'post',
                url: '@Url.Content("~/api/GQT/QTSysSetApi/PostPayUsbKeyIsActive")',
                data: data,
                datatype: 'json',
                success: function (data, textstatus) {
                    console.log(JSON.parse(data));
                    $('#response').text(data);
                },
                error: function (xmlhttprequest, textstatus, errorThrown) {
                    $('#response').text(xmlhttprequest.responseText);
                }
            });
        });
    })
       

    function upFile() {

        var form = new FormData();
        form.append("file", $("#upload_file")[0].files[0]);
        //form.append("file", $("#upload_file2")[0].files[0]);
        //form.append("file", $("#upload_file3")[0].files[0]);
        //新增新闻
        /*
        form.append("PhIdType", "199181225000001");             //信息类别
        form.append("Title", "测试数据");                       //标题
        form.append("Content", "这是一条测试新增的数据");       //内容
        form.append("Name", "网络");                            //来源
        form.append("LevelType","1");                           //制度级别
        */

        //修改新闻
        /*
        form.append("PhId", "553181226000001");
        form.append("PhIdType", "199181225000001");
        form.append("Title", "测试数据2");
        form.append("Content", "这是一条测试修改的数据2");
        form.append("Hitrate", "0");
        form.append("Publish", "0");
        form.append("Ontop", "0");
        form.append("Name", "网络");
        form.append("Picpath", "/UpLoadFiles/SysNews/2018-12-26/cd8e680ddb9140c4afeeb29289bd19f6.jpg");
        form.append("AttachmentName", "img.jpg");
        form.append("AttachmentSize", "6.00");
        form.append("LevelType", "1");
        form.append("Creator", "521180820000001");
        form.append("Editor", "521180820000001");
        form.append("CurOrgId", "521180820000002");
        form.append("NgInsertDt", "2018-12-26 20:00:24.000");
        form.append("NgUpdateDt", "2018-12-26 20:00:24.000");
        form.append("NgRecordVer", "2");
        */

        //新增图片新闻
        //form.append("Title", "测试数据");

        //修改图片新闻
        /*form.append("PhId", "559181226000001");
        form.append("Title", "测试修改4");
        form.append("Picpath", "/UpLoadFiles/SysPicture/2018-12-27/3a61a8c1d9f34cecb11fe6255e55445e.png");
        form.append("AttachmentName", "logo.png");
        form.append("AttachmentSize","3.82");
        form.append("Publish", "0");
        form.append("Ontop", "0");
        form.append("SortCode", "0");*/
        //form.append("Creator", "521180820000001");
        //form.append("Editor", "521180820000001");
        //form.append("CurOrgId", "521180820000002");
        //form.append("NgInsertDt", "2018-12-26 22:09:22.000");
        //form.append("NgUpdateDt", "2018-12-26 22:38:28.000");
        //form.append("NgRecordVer", "6");

        //console.log(form)

        @*$.ajax({
            headers: {
                'Accept': "multipart/form-data; charset=utf-8",
                'AppInfo': $.base64.encode(JSON.stringify(appinfo)),
                'Sign': items
            },
            url: '@Url.Content("~/api/GCW/SysNews/PostUpdateSysNews")',
            type: 'post',
            data: form,
            processData: false,
            contentType: false,
            success: function (data, textstatus) {
                console.log(data);
                alert("上传成功");
            },
            error: function (xmlhttprequest, textstatus, errorThrown) {
                alert("服务器未正常响应，请重试");
            }
        });*@

        //var FileResultDTO = new {
        //    ID = 1111, FileName=$("#upload_file")[0].files[0].FileName,
        //    ServerFileName= ""
        //};

        $.ajax({
            headers: {
                'Accept': "multipart/form-data; charset=utf-8",
                'AppInfo': $.base64.encode(JSON.stringify(appinfo)),
                'Sign': items
            },
            url: '@Url.Content("~/api/GCW/SysOrganize/PostInportTxt")',
            type: 'post',
            data: '',
            processData: false,
            contentType: false,
            success: function (data, textstatus) {
                console.log(data);
                alert("上传成功");
            },
            error: function (xmlhttprequest, textstatus, errorThrown) {
                alert("服务器未正常响应，请重试");
            }
        });
    }
</script>
